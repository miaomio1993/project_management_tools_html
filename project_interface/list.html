<html>
<head>
    <link rel="stylesheet" href="https://cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://cdn.bootcss.com/bootstrap/3.3.6/css/bootstrap.min.css">
    <link href="https://cdn.bootcss.com/bootstrap-select/1.12.4/css/bootstrap-select.min.css" rel="stylesheet">
    <link rel="stylesheet" href="../assets/css/xenon-core.css">
    <link rel="stylesheet" href="../assets/css/xenon-forms.css">
    <link rel="stylesheet" href="../assets/css/xenon-components.css">
    <link rel="stylesheet" href="../assets/css/xenon-skins.css">
    <link rel="stylesheet" href="../assets/css/custom.css">
    <script src="https://cdn.bootcss.com/jquery/1.12.3/jquery.min.js"></script>
    <title>项目接口列表</title>
</head>

<body>
<div class="row" style="padding: 20px; margin: auto;">
    <div class="col-sm-2">
        <select id="projectId" class="selectpicker" data-live-search="true" data-size="8">
        </select>
    </div>
    <div class="col-sm-2">
        <select id="projectGroupId" class="selectpicker" data-live-search="true" data-size="8">
            <option>接口分组</option>
        </select>
    </div>
    <div class="col-sm-2">
        <select id="projectInterfaceStatsId" class="selectpicker" data-size="8">
            <option value="0">全部</option>
            <option value="1">待开发</option>
            <option value="2">开发中</option>
            <option value="3">可对接</option>
            <option value="4">维护中</option>
            <option value="5">已弃用</option>
        </select>
    </div>
    <div class="col-sm-6">
        <div class='btn-group pull-right'>
            <a id="add" type='button' class='btn btn-default btn-sm'>INSERT</a>
        </div>
    </div>
</div>

<div class="panel panel-default">
    <div class="panel-body">
        <div class="row">
            <div class="col-sm-12">
                <table class="table table-model-1">
                    <thead>
                    <tr>
                        <th>ID</th>
                        <th title="接口名称">Interface Name</th>
                        <th title="接口描述">Interface Desc</th>
                        <th title="接口状态">Interface State</th>
                        <th title="请求地址">Request Url</th>
                        <th title="请求类型">Request Type</th>
                        <th title="相关操作">Operation</th>
                    </tr>
                    </thead>
                    <tbody>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.bootcss.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
<script src="https://cdn.bootcss.com/bootstrap-select/1.12.4/js/bootstrap-select.min.js"></script>
<script src="../assets/js/initialization.js"></script>

<script type="text/javascript">
    $(function () {
        getProjectList();
        getProjectGroupList();
        getProjectInterfaceList();
    });

    $('#projectId').on('changed.bs.select', function (e) {
        getProjectGroupList();
        getProjectInterfaceList();
    });

    $('#projectGroupId').on('changed.bs.select', function (e) {
        getProjectInterfaceList();
    });

    $('#projectInterfaceStatsId').on('changed.bs.select', function (e) {
        getProjectInterfaceList();
    });

    function getProjectList(){
        $.ajax({
            type: 'post',
            url: url + "project/getList",
            async: false,
            success: function (data) {
                if (data.code == 0) {
                    data = data.data;
                    $("#projectId").html("");
                    var str = "<option value='0'>请选择项目</option>";
                    for (var i = 0; i < data.length; i++) {
                        str += "<option value='" + data[i].id + "'>" + data[i].name + "</option>"
                    }
                    $("#projectId").html(str);
                    $('#projectId').selectpicker('refresh');
                } else {
                    alert(data.msg);
                }
            }
        });
    }

    function getProjectGroupList(){
        $.ajax({
            type: 'post',
            url: url + "projectGroup/getList",
            async: false,
            data: {
                projectId: $('#projectId').val()
            },
            success: function (data) {
                if (data.code == 0) {
                    data = data.data;
                    $("#projectGroupId").html("");
                    var str = "<option value='0'>请选择分类</option>";
                    for (var i = 0; i < data.length; i++) {
                        str += "<option value='" + data[i].id + "'>" + data[i].name + "</option>"
                    }
                    $("#projectGroupId").html(str);
                    $('#projectGroupId').selectpicker('refresh');
                } else {
                    alert(data.msg);
                }
            }
        });
    }

    function getProjectInterfaceList() {
        if($('#projectId').val() == 0){
            return false;
        }
        $.ajax({
            type: 'post',
            url: url + "projectInterface/getList",
            async: false,
            data: {
                projectId: $('#projectId').val(),
                projectGroupId: $('#projectGroupId').val(),
                projectInterfaceStatsId: $('#projectInterfaceStatsId').val()
            },
            success: function (data) {
                if (data.code == 0) {
                    $(".table tbody").html("");
                    data = data.data;
                    var str = "";
                    for (let i = 0; i < data.length; i++) {
                        str += "<tr>";
                        str += "    <td>" + data[i].id + "</td>";
                        str += "    <td>" + data[i].name + "</td>";
                        str += "    <td>" + data[i].depict + "</td>";
                        if(data[i].state = 1){
                            str += "<td>待开发</td>";
                        } else if (data[i].state = 2){
                            str += "<td>开发中</td>";
                        } else if (data[i].state = 3){
                            str += "<td>已完成</td>";
                        } else if (data[i].state = 4){
                            str += "<td>维护中</td>";
                        } else if (data[i].state = 5){
                            str += "<td>已弃用</td>";
                        }
                        str += "    <td>" + data[i].url + "</td>";
                        str += "    <td>" + data[i].type + "</td>";
                        str += "    <td style='padding: 8px;'>";
                        str += "        <div class='btn-group'>";
                        str += "        <a type='button' class='btn btn-default btn-sm' href='up.html?projectId="+data[i].projectId+"&projectGroupId="+data[i].groupId+"&projectInterfaceId="+data[i].id+"'>UPDATE</a>";
                        str += "        <a type='button' class='btn btn-default btn-sm' href='#' onclick='deletes("+data[i].id+")'>DELETE</a>";
                        str += "        </div>";
                        str += "    </td>";
                        str += "</tr>";
                    }
                    $(".table tbody").html(str);
                } else {
                    alert(data.msg);
                }
            }
        });
    }

    $("#add").click(function (){
        var projectId = $('#projectId').val();
        var projectGroupId = $('#projectGroupId').val();
        if(projectId == null || projectId == 0){
            alert("请选择项目或分组");
            return false;
        }
        if(projectGroupId == null || projectGroupId == 0){
            alert("请选择项目或分组");
            return false;
        }
        location.href='add.html?projectId='+projectId+"&projectGroupId="+projectGroupId;
    });

    function deletes(id) {
        if (confirm("是否删除?")) {
            $.ajax({
                type: 'post',
                url: url + "projectInterface/del",
                data: {
                    projectInterfaceId: id
                },
                success: function (data) {
                    alert(data.msg);
                    getList();
                }
            });
        }
    }

</script>
</body>
</html>
